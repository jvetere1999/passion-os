# Ignition - Cloudflare Workers Configuration
# See: https://developers.cloudflare.com/workers/
# OpenNext: https://opennext.js.org/cloudflare

name = "ignition"
compatibility_date = "2025-01-02"
compatibility_flags = ["nodejs_compat"]

# OpenNext output directory
main = ".open-next/worker.js"

[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "ignition"
database_id = "40c2b3a5-7fa1-492f-bce9-3c30959b56a8"

# R2 Bucket binding for audio files and blobs
[[r2_buckets]]
binding = "BLOBS"
bucket_name = "ignition-blobs"

# KV Namespace for caching (optional, uncomment if needed)
# [[kv_namespaces]]
# binding = "CACHE"
# id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# Environment variables (non-sensitive)
[vars]
NODE_ENV = "production"
NEXT_PUBLIC_APP_URL = "https://ignition.ecent.online"
AUTH_URL = "https://ignition.ecent.online"
AUTH_TRUST_HOST = "true"
ADMIN_EMAILS = "jvetere1999@gmail.com"
NEXT_PUBLIC_ADMIN_EMAILS = "jvetere1999@gmail.com"

# Preview environment
[env.preview]
name = "ignition-preview"

[env.preview.vars]
NODE_ENV = "preview"
NEXT_PUBLIC_APP_URL = "https://ignition-preview.jvetere1999.workers.dev"
AUTH_URL = "https://ignition-preview.jvetere1999.workers.dev"
AUTH_TRUST_HOST = "true"
ADMIN_EMAILS = "jvetere1999@gmail.com"
NEXT_PUBLIC_ADMIN_EMAILS = "jvetere1999@gmail.com"


# ============================================
# SECRETS - Set via: wrangler secret put <NAME>
# ============================================
# Required:
#   wrangler secret put AUTH_SECRET
#   wrangler secret put GOOGLE_CLIENT_ID
#   wrangler secret put GOOGLE_CLIENT_SECRET
#   wrangler secret put AZURE_AD_CLIENT_ID
#   wrangler secret put AZURE_AD_CLIENT_SECRET
#   wrangler secret put AZURE_AD_TENANT_ID
#
# For preview env:
#   wrangler secret put AUTH_SECRET --env preview
#   ... (repeat for all secrets)

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1