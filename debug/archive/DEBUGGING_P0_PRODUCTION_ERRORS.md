# P0 PRODUCTION ERRORS - 2026-01-12 02:59 UTC

**Status**: ðŸ”´ **ACTIVE - 3 CRITICAL BLOCKING ERRORS**  
**Severity**: All P0 - OAuth works but data sync broken  
**User Impact**: Can login, cannot load data

---

## ERROR 1: Type Mismatch - INT4 vs INT8

**Timestamp**: 2026-01-12T02:59:57.927521Z  
**Error Message**: 
```
error occurred while decoding column 1: mismatched types; 
Rust type `i64` (as SQL type `INT8`) is not compatible with SQL type `INT4`
```
**Latency**: 1069 ms  
**Impact**: ðŸ”´ **BLOCKS SYNC** - User cannot load data

### Questions (Phase 3: EXPLORER)

1. **Which endpoint triggered this?** (Need endpoint path from logs)
2. **Which column is INT4 instead of INT8?**
   - Check migration 0001_schema.sql for INT vs BIGINT/INT8
   - Likely candidates: user_progress.level, user_wallet.coins, user_streaks fields
3. **Does schema.json declare INT or INT8 for this field?**
   - Search schema.json for type definitions
4. **Does generated.rs expect i64 (64-bit) but schema says INT (32-bit)?**

### Investigation Path
```bash
# Find INT4 columns in migration
grep "INT\|INT4" app/backend/migrations/0001_schema.sql

# Check schema.json definitions
grep -A 2 '"type": "INT"' schema.json | head -50

# Find which code queries this (look at sync, today, etc endpoints)
grep -r "decode column 1" app/backend/
```

---

## ERROR 2: Missing Column "theme"

**Timestamp**: 2026-01-12T02:59:57.946614Z  
**Location**: Connection pool test query (on-release)  
**Error Message**: 
```
error returned from database: column "theme" does not exist
```
**Impact**: ðŸ”´ **CONNECTION POOL DYING** - intermittent 500s

### Questions (Phase 3: EXPLORER)

1. **Where is the "on-release" connection test query?**
   - Is it in sqlx configuration?
   - Is it a hardcoded SELECT in health check?
   - Where is pool.acquire() failing?

2. **Which table is being queried?**
   - user_settings.theme (does not exist in schema.json)?
   - users.theme (does migration have this column)?

3. **Did migration actually add users.theme?**
   - Check 0001_schema.sql around users table definition

4. **Is this auto-generated by sqlx or hardcoded?**
   - If hardcoded, where?
   - If auto-generated from schema, why is schema wrong?

### Investigation Path
```bash
# Check if users.theme exists in migration
grep -A 30 "CREATE TABLE users" app/backend/migrations/0001_schema.sql | grep theme

# Check schema.json for users.theme definition
grep -B 2 -A 5 '"type": "TEXT"' schema.json | grep -A 5 users

# Find connection pool config
grep -r "on-release" app/backend/
grep -r "connection.*test" app/backend/
```

---

## ERROR 3: Missing Column "key"

**Timestamp**: 2026-01-12T02:59:58.118561Z  
**Error Message**: 
```
error returned from database: column "key" does not exist
```
**Latency**: 1223 ms  
**Impact**: ðŸ”´ **BLOCKS QUERY** - Unknown endpoint returning 500

### Questions (Phase 3: EXPLORER)

1. **Which code path references user_settings.key?**
   - Search for "key" in user_settings queries
   - This was removed from schema - why is code still using it?

2. **Is this hardcoded query or generated?**
   - If generated, why wasn't it regenerated?
   - If hardcoded, which file?

3. **Should user_settings have a key field?**
   - Check original SCHEMA_SPEC or design
   - Or should code be updated to remove key references?

4. **Which endpoint is calling this?**
   - Need to trace the error back to handler

### Investigation Path
```bash
# Find all references to user_settings.key
grep -r "user_settings.*key\|key.*user_settings" app/backend/

# Find where this query is defined
grep -r "SELECT.*key" app/backend/crates/api/src/

# Check what schema.json says about user_settings fields
grep -B 2 -A 30 '"user_settings"' schema.json | head -50
```

---

## BLOCKER SEQUENCE FOR FIXING

**Order to investigate**:
1. **INT4 vs INT8** - Find which column (check migration)
2. **theme column** - Find connection test query (check config)
3. **key column** - Find code reference (grep for user_settings.key)

**All three must be fixed before data sync works for authenticated users.**

---

## ROOT CAUSE ANALYSIS

**Pattern**: Code and database schema are misaligned after regeneration

**Hypothesis**:
- Generated schema/code doesn't match root schema.json
- Or root schema.json is incomplete/wrong
- Or migration wasn't fully regenerated

**Next Step**: Validate schema.json vs migration vs generated code alignment
