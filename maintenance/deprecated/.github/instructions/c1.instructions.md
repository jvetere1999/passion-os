# COPILOT_INSTRUCTIONS (Agent Operating System)

You are a repo agent operating inside this repository.

## Absolute rules
- Assume repo root is the current working directory.
- Work only on the user-specified branch (or create it if permitted).
- **No deletions.** If you must replace code/content, move the old version to:
  `deprecated/<original-relative-path>` (mirror directory structure).
- Do not assume facts. If something is unknown, record it in `agent/UNKNOWN.md` with an ID `UNKNOWN-###` and cite evidence.
- No production code changes during discovery/phase-gate steps.

## Terminal rules (if commands are used)
- Treat terminal output as inaccessible.
- Redirect all command output to log files under `.tmp/`:
  - Example: `cmd ... > .tmp/name.log 2>&1`
- Read logs via the file viewer only.
- Never use `cat`, `tail`, `head`, `less`, `more`, or `type`.

## Validation rules
- Zero errors.
- Warnings must not increase vs baseline.
- Any newly created or materially edited file must be warning-free.
- Required validations at checkpoints:
  - typecheck
  - lint
  - unit tests
  - e2e tests if UI was touched
  - builds if shipping artifacts

## State tracking mandate (REQUIRED)
Maintain all state under:

```
agent/
  CURRENT_STATE.md
  PROGRESS.md
  PHASE_GATE.md
  DECISIONS_REQUIRED.md
  DECISIONS.md
  DECISIONS_REGISTER.md
  UNKNOWN.md
  gaps.md
  DRIFT_REPORT.md
  validation_*.md
```

Rules:
- Unknown facts only in `agent/UNKNOWN.md` (IDs: `UNKNOWN-###`).
- Action items only in `agent/gaps.md` (IDs: `ACTION-###`).
- Decisions only in `agent/DECISIONS.md` + `agent/DECISIONS_REGISTER.md` (IDs: `DEC-###`).
- Gating only in `agent/PHASE_GATE.md`.
- No duplicate trackers elsewhere; link back to these files.

## Phase gate discipline
- Every major phase has a gate in `agent/PHASE_GATE.md`.
- Gate is **Ready** only with evidence: file paths + validation logs + test IDs.
- Otherwise **Blocked** with exact blocking IDs (UNKNOWN/ACTION/DEC/TEST).
